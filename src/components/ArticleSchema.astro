---
interface Props {
	title: string;
	headline?: string;
	description: string;
	image?: string;
	datePublished: Date | string;
	dateModified?: Date | string;
	author?: {
		name: string;
		url?: string;
	};
	canonicalUrl: string;
}

const {
	title,
	headline,
	description,
	image,
	datePublished,
	dateModified,
	author = { name: 'Pierre', url: 'https://www.reddit.com/user/Patient-Gene703/' },
	canonicalUrl,
} = Astro.props;

const schemaHeadline = headline || title;

const defaultAuthor = { name: 'Pierre', url: 'https://www.reddit.com/user/Patient-Gene703/' };
const resolvedAuthor = {
	name: author?.name || defaultAuthor.name,
	url: author?.url || defaultAuthor.url,
};

const publisher = {
	'@type': 'Organization',
	name: 'The Optimization Guy',
	logo: {
		'@type': 'ImageObject',
		url: new URL('/hannibal-cercle.png', Astro.site).href,
	},
};

const defaultImage = new URL('/hannibal.jpg', Astro.site).href;

const schema = {
	'@context': 'https://schema.org',
	'@type': 'Article',
	headline: schemaHeadline,
	description,
	image: image || defaultImage,
	datePublished:
		typeof datePublished === 'string' ? datePublished : datePublished.toISOString(),
	dateModified: dateModified
		? typeof dateModified === 'string'
			? dateModified
			: dateModified.toISOString()
		: typeof datePublished === 'string'
			? datePublished
			: datePublished.toISOString(),
	author: {
		'@type': 'Person',
		name: resolvedAuthor.name,
		url: resolvedAuthor.url,
	},
	publisher,
	mainEntityOfPage: {
		'@type': 'WebPage',
		'@id': canonicalUrl,
	},
	speakable: {
		'@type': 'SpeakableSpecification',
		cssSelector: ['.hero-title', '.prose > p:first-of-type'],
	},
};
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
