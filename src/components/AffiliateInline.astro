---
export interface Props {
  href: string;
  title: string;
  price: string;
  imageSrc: string;
  imageAlt?: string;
  cta?: string;
  disclaimer?: string;
  dataAff?: string;
}

const {
  href,
  title,
  price,
  imageSrc,
  imageAlt = title,
  cta = "Voir le produit",
  disclaimer,
  dataAff,
} = Astro.props;

const ariaLabel = `${title} â€” ${price} (${cta})`;
---

<div class="aff-inline-wrapper not-prose">
  <a
    class="aff-inline"
    href={href}
    target="_blank"
    rel="sponsored noopener noreferrer"
    aria-label={ariaLabel}
    data-aff={dataAff}
  >
    <div class="aff-inline__inner">
      <div class="aff-inline__thumb">
        <img
          class="aff-inline__img"
          src={imageSrc}
          alt={imageAlt}
          loading="lazy"
          decoding="async"
        />
      </div>
      <div class="aff-inline__content">
        <div class="aff-inline__title">{title}</div>
        <div class="aff-inline__price">{price}</div>
        {disclaimer && <div class="aff-inline__disclaimer">{disclaimer}</div>}
      </div>
      <span class="aff-inline__cta" aria-hidden="true">{cta}</span>
    </div>
  </a>
</div>

<style>
  :global(:root) {
    --aff-bg: #f8fafc;
    --aff-border: #e2e8f0;
    --aff-text: #0f172a;
    --aff-muted: #475569;
    --aff-shadow: 0 10px 15px -3px rgb(15 23 42 / 0.12),
      0 4px 6px -4px rgb(15 23 42 / 0.12);
    --aff-cta-bg: #0f172a;
    --aff-cta-text: #ffffff;
  }

  :global(html.dark) {
    --aff-bg: #0b1220;
    --aff-border: rgb(148 163 184 / 0.25);
    --aff-text: #e5e7eb;
    --aff-muted: #94a3b8;
    --aff-shadow: 0 10px 18px -8px rgb(0 0 0 / 0.55);
    --aff-cta-bg: rgb(255 255 255 / 0.1);
    --aff-cta-text: #e5e7eb;
  }

  .aff-inline-wrapper {
    margin: 1.5rem 0;
  }

  .aff-inline {
    display: block;
    background: var(--aff-bg);
    border: 1px solid var(--aff-border);
    color: var(--aff-text);
    border-radius: 16px;
    box-shadow: var(--aff-shadow);
    overflow: hidden;
    text-decoration: none;
    transition: transform 0.18s ease, border-color 0.18s ease,
      background-color 0.18s ease, box-shadow 0.18s ease;
  }

  .aff-inline__inner {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 14px 16px;
    min-width: 0;
  }

  .aff-inline:hover {
    transform: translateY(-1px);
    border-color: var(--aff-border);
    box-shadow: 0 14px 30px -12px rgb(0 0 0 / 0.15);
  }

  .aff-inline:focus-visible {
    outline: none;
    transform: translateY(-1px);
    border-color: var(--aff-border);
    box-shadow: 0 0 0 3px rgb(255 208 77 / 0.35);
  }

  .aff-inline__thumb {
    width: 56px;
    aspect-ratio: 1 / 1;
    flex: 0 0 56px;
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgb(0 0 0 / 0.04);
    border: 1px solid var(--aff-border);
  }

  :global(html.dark) .aff-inline__thumb {
    background: rgb(255 255 255 / 0.06);
  }

  .aff-inline__img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center;
    display: block;
  }

  .aff-inline__content {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
    flex: 1;
  }

  .aff-inline__title {
    font-weight: 700;
    line-height: 1.2;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .aff-inline__price {
    font-weight: 700;
    font-size: 0.95rem;
    color: var(--aff-text);
    margin: 2px 0 0;
  }

  .aff-inline__cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex: 0 0 auto;
    padding: 10px 14px;
    border-radius: 999px;
    background: var(--aff-cta-bg);
    color: var(--aff-cta-text);
    border: 1px solid var(--aff-border);
    font-weight: 600;
    font-size: 0.95rem;
    text-align: center;
    box-sizing: border-box;
    max-width: 100%;
    transition: transform 0.15s ease, filter 0.18s ease, border-color 0.18s ease;
  }

  .aff-inline__cta:hover {
    transform: translateY(-1px);
    filter: brightness(1.05);
  }

  .aff-inline__disclaimer {
    font-size: 0.88rem;
    color: var(--aff-muted);
    margin-top: 6px;
    line-height: 1.4;
  }

  @media (max-width: 520px) {
    .aff-inline {
      border-radius: 14px;
    }

    .aff-inline__inner {
      flex-direction: column;
      align-items: stretch;
      gap: 12px;
    }

    .aff-inline__thumb {
      width: 64px;
      height: 64px;
      flex-basis: 64px;
      align-self: flex-start;
    }

    .aff-inline__title {
      white-space: normal;
    }

    .aff-inline__cta {
      width: 100%;
      position: static;
      left: auto;
      right: auto;
    }
  }
</style>
